<?xml version="1.0" encoding="UTF-8" ?>
<launch>
    <arg name="robot" default="X1" doc="Robot name, also ROS graph and TF namespace."/>
    <arg name="robot_type" default="explorer_x1" doc="Robot type, from {absolem, dtr, explorer_x1, marv, x1, x2}."/>
    <arg name="robots" default="$(arg robot)"/>
    <arg name="points_min_dist" default="0.125"/>
    <arg name="cmd_vel" default="cmd_vel"/>
    <arg name="follow_opt_path" default="true"/>
    <arg name="do_recording" default="false"/>
    <arg if="$(eval follow_opt_path==false)" name="path" default="path"/>
    <arg if="$(eval follow_opt_path==true)" name="path" default="optimized_path"/>
    <arg name="publish_ground_truth" default="true" />
    <arg name="record_duration" default="30m"/>
    <arg name="debug_trajopt" default="false"/>
    <arg name="trajopt_iters" default="25"/>

    <!-- Subt frame publisher-->
    <node name="subt_frame_publisher" pkg="subt_virtual" type="subt_frame_publisher">
        <param name="robot_name" value="$(arg robot)"/>
    </node>

    <!-- Robot ground truth frame publisher-->
    <node if="$(arg publish_ground_truth)" name="ground_truth_publisher" pkg="subt_virtual" type="ground_truth_publisher">
        <param name="robot_name" value="$(arg robot)" />
    </node>

    <!-- Navigation and Exploration with Trajectory Optimization -->
    <group ns="$(arg robot)">
        <include file="$(find naex)/launch/naex.launch" pass_all_args="true"/>
        <include if="$(arg follow_opt_path)" file="$(find rpz_planning)/launch/rpz_predictor.launch" pass_all_args="true"/>
        <include if="$(arg follow_opt_path)" file="$(find rpz_planning)/launch/rpz_planner.launch" pass_all_args="true"/>
    </group>

    <!-- Data recording -->
    <group if="$(arg do_recording)">
        <arg name="record_topics"
             value="/$(arg robot)/local_map_slow
                    /$(arg robot)/updated_map
                    /$(arg robot)/$(arg path)
                    /tf
                    /tf_static"/>

<!--        <arg name="record_topics"-->
<!--             value="/$(arg robot)/front_rgbd/optical/camera_info-->
<!--                    /$(arg robot)/left_rgbd/optical/camera_info-->
<!--                    /$(arg robot)/local_map_slow-->
<!--                    /$(arg robot)/path-->
<!--                    /$(arg robot)/rear_rgbd/optical/camera_info-->
<!--                    /$(arg robot)/right_rgbd/optical/camera_info-->
<!--                    /tf-->
<!--                    /tf_static-->
<!--                    /$(arg robot)/traversability"/>-->

        <node name="record_data" pkg="rosbag" type="record"
              args="-o $(find rpz_planning)/$(arg robot_type)_opt_path_$(arg follow_opt_path)
                    $(arg record_topics)
                    --duration $(arg record_duration)"/>
    </group>
</launch>
