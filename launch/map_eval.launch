<?xml version="1.0" encoding="UTF-8" ?>
<launch>
    <arg name="robot" default="X1"/>
    <arg name="world_name" default="simple_cave_02"/>
    <arg name="gt_mesh_file" default="$(find rpz_planning)/data/meshes/$(arg world_name).obj"/>
    <arg name="rviz" default="true"/>
    <arg name="rqt_plot" default="false"/>
    <arg name="do_eval" default="true"/>
    <arg name="load_gt" default="true"/>
    <arg name="eval_rate" default="0.05"/> <!-- how often do mapping evaluation -->
    <arg name="bag" default="$(find rpz_planning)/data/bags/mapping_eval/explorer_x1_opt_path_false_simple_cave_02_2021-06-07-09-08-22.bag"/>
    <arg name="bag_rate" default="4.0"/>
    <arg name="bag_start" default="0.0"/>
    <arg name="pcl_msg_max_age" default="5.0"/>

    <param name="use_sim_time" value="true" />

    <!-- Map accumulator node -->
    <include file="$(find rpz_planning)/launch/map_accumulator.launch">
        <arg name="robot" value="$(arg robot)"/>
        <arg name="bag" value="$(arg bag)"/>
        <arg name="rate" value="$(arg bag_rate)"/>
        <arg name="start" value="$(arg bag_start)"/>
    </include>

    <!-- Mapping evaluation -->
    <node ns="$(arg robot)" name="map_eval" pkg="rpz_planning" type="map_eval.py" output="screen">
        <rosparam subst_value="true">
            map_topic: map_accumulator/map
            gt_mesh: $(arg gt_mesh_file)
            normalize_mesh_pcl: False
            do_points_sampling: True
            do_eval: $(arg do_eval)
            load_gt: $(arg load_gt)
            n_sample_points: 100000
            max_age: $(arg pcl_msg_max_age)
            map_frame: $(arg world_name)
<!--            map_frame: subt-->
            eval_rate: $(arg eval_rate)
        </rosparam>
    </node>

    <!-- RVIZ -->
    <node if="$(arg rviz)" name="rviz" pkg="rviz" type="rviz"
          args="-d $(dirname)/../config/map_accum.rviz"/>
    <!-- RQT plot -->
    <group if="$(arg rqt_plot)">
        <node name="rqt_plot_explor_losses" pkg="rqt_plot" type="rqt_plot"
          args="$(arg robot)/map_eval/exp_loss_face/data
                $(arg robot)/map_eval/exp_loss_edge/data
                $(arg robot)/map_eval/exp_loss_chamfer/data"/>
        <node name="rqt_plot_map_acc" pkg="rqt_plot" type="rqt_plot"
          args="$(arg robot)/map_eval/map_loss_face/data
                $(arg robot)/map_eval/map_loss_edge/data
                $(arg robot)/map_eval/map_loss_chamfer/data"/>
    </group>
<!--    <node if="$(arg rqt_plot)" name="rqt_multiplot" pkg="rqt_multiplot" type="rqt_multiplot"-->
<!--          args="&#45;&#45;multiplot-config $(dirname)/../config/rqt_multiplot_map_eval.xml"/>-->
</launch>
